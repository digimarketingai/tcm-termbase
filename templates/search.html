{% extends "base.html" %}

{% block title %}Search Results - TCM Termbase{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Search Form -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <form action="{{ url_for('search') }}" method="GET" class="flex flex-col md:flex-row gap-4">
            <input type="text" 
                   name="q" 
                   value="{{ query }}"
                   placeholder="Search terms..."
                   class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
            <select name="category" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if category_id == cat.id %}selected{% endif %}>{{ cat.name_en }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="bg-teal-600 text-white px-8 py-3 rounded-lg hover:bg-teal-700 transition">
                Search
            </button>
        </form>
    </div>

    {% if query %}
    <!-- Results -->
    <div class="mb-4">
        <h1 class="text-2xl font-bold text-gray-900">
            Search Results for "{{ query }}"
        </h1>
        <p class="text-gray-600">{{ pagination.total if pagination else 0 }} terms found</p>
    </div>

    {% if terms %}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Chinese</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Pinyin</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">English</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase hidden md:table-cell">Category</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for term in terms %}
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='{{ url_for('term_detail', term_id=term.id) }}'">
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <span class="chinese-text text-lg font-medium text-gray-900">{{ term.chinese_simplified }}</span>
                            {% if term.chinese_traditional and term.chinese_traditional != term.chinese_simplified %}
                            <span class="chinese-text text-gray-500 ml-2">({{ term.chinese_traditional }})</span>
                            {% endif %}
                            {% if term.who_standard %}<span class="who-badge ml-2">WHO</span>{% endif %}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-gray-600">{{ term.pinyin }}</td>
                    <td class="px-6 py-4">
                        <div class="text-gray-900">{{ term.english_term }}</div>
                        {% if term.english_aliases %}
                        <div class="text-sm text-gray-500">{{ term.english_aliases }}</div>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-gray-500 hidden md:table-cell">{{ term.category.name_en if term.category else '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if pagination.pages > 1 %}
    <div class="mt-6 flex justify-center">
        <nav class="flex space-x-2">
            {% if pagination.has_prev %}
            <a href="{{ url_for('search', q=query, category=category_id, page=pagination.prev_num) }}" 
               class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">Previous</a>
            {% endif %}
            
            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
                {% if page_num %}
                    <a href="{{ url_for('search', q=query, category=category_id, page=page_num) }}" 
                       class="px-4 py-2 border rounded-lg {% if page_num == pagination.page %}bg-teal-600 text-white border-teal-600{% else %}bg-white border-gray-300 hover:bg-gray-50{% endif %}">
                        {{ page_num }}
                    </a>
                {% else %}
                    <span class="px-4 py-2">...</span>
                {% endif %}
            {% endfor %}
            
            {% if pagination.has_next %}
            <a href="{{ url_for('search', q=query, category=category_id, page=pagination.next_num) }}" 
               class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">Next</a>
            {% endif %}
        </nav>
    </div>
    {% endif %}

    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500 text-lg">No terms found matching your search.</p>
        <p class="text-gray-400 mt-2">Try different keywords or browse by category.</p>
    </div>
    {% endif %}

    {% else %}
    <div class="bg-white rounded-lg shadow p-12 text-center">
        <p class="text-gray-500 text-lg">Enter a search term to find TCM terminology.</p>
        <p class="text-gray-400 mt-2">Search in Chinese (simplified or traditional), Pinyin, or English.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
